# ==================================================================================================================== #
# Authors:                                                                                                             #
#   Patrick Lehmann                                                                                                    #
#   Unai Martinez-Corral                                                                                               #
#                                                                                                                      #
# ==================================================================================================================== #
# Copyright 2020-2021 The pyTooling Authors                                                                            #
#                                                                                                                      #
# Licensed under the Apache License, Version 2.0 (the "License");                                                      #
# you may not use this file except in compliance with the License.                                                     #
# You may obtain a copy of the License at                                                                              #
#                                                                                                                      #
#   http://www.apache.org/licenses/LICENSE-2.0                                                                         #
#                                                                                                                      #
# Unless required by applicable law or agreed to in writing, software                                                  #
# distributed under the License is distributed on an "AS IS" BASIS,                                                    #
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                             #
# See the License for the specific language governing permissions and                                                  #
# limitations under the License.                                                                                       #
#                                                                                                                      #
# SPDX-License-Identifier: Apache-2.0                                                                                  #
# ==================================================================================================================== #
name: Parameters

on:
  workflow_call:
    inputs:
      python_version:
        description: 'Python version.'
        required: false
        default: '3.10'
        type: string
      python_version_list:
        description: 'Space separated list of Python versions to run tests with.'
        required: false
        default: '3.6 3.7 3.8 3.9 3.10'
        type: string
      name:
        description: 'Name of the tool/package.'
        required: true
        type: string
    outputs:
      params:
        description: "Parameters to be used in other jobs."
        value: ${{ jobs.Parameters.outputs.params }}
      python_jobs:
        description: "List of Python versions to be used in the matrix of other jobs."
        value: ${{ jobs.Parameters.outputs.python_jobs }}

jobs:

  Parameters:
    runs-on: ubuntu-latest
    outputs:
      params: ${{ steps.params.outputs.params }}
      python_jobs: ${{ steps.params.outputs.python_jobs }}
    steps:

      - name: Generate 'params' and 'python_jobs'
        id: params
        shell: python
        run: |
          name = '${{ inputs.name }}'
          params = {
            'python_version': '${{ inputs.python_version }}',
            'artifacts': {
              'unittesting': f'{name}-TestReport',
              'coverage': f'{name}-coverage',
              'typing': f'{name}-typing',
              'package': f'{name}-package',
              'doc': f'{name}-doc',
            }
          }
          print(f'::set-output name=params::{params!s}')
          print("Parameters:")
          print(params)

          data = {
             '3.6': { 'icon': 'ðŸ”´', 'until': '23.12.2021' },
             '3.7': { 'icon': 'ðŸŸ ', 'until': '27.06.2023' },
             '3.8': { 'icon': 'ðŸŸ¡', 'until': 'Oct. 2024' },
             '3.9': { 'icon': 'ðŸŸ¢', 'until': 'Oct. 2025' },
            '3.10': { 'icon': 'ðŸŸ¢', 'until': 'Oct. 2026' },
          }
          jobs = [
              {'python': version, 'icon': data[version]['icon']}
              for version in '${{ inputs.python_version_list }}'.split(' ')
          ]
          print(f'::set-output name=python_jobs::{jobs!s}')
          print("Python jobs:")
          print(jobs)
